# Prophet 时间序列预测示例

这个目录包含了使用 Facebook Prophet 库进行时间序列预测的示例代码。Prophet 是一个强大的时间序列预测工具，特别适合处理具有季节性模式、趋势变化和节假日影响的业务预测问题。

## 功能特性

本示例代码包含以下功能：

### 基础功能
- 数据准备和预处理（Prophet 格式要求：ds 列表示日期，y 列表示目标值）
- 模型初始化和训练
- 未来预测
- 结果可视化（预测图和组件分解图）

### 高级功能
1. **乘法季节性模型** - 适用于季节性幅度随趋势增长的情况
2. **交叉验证和模型评估** - 评估预测性能，计算 MAPE、MSE 等指标
3. **异常值检测和处理** - 通过参数调优提高模型对异常值的鲁棒性
4. **自定义季节性模式** - 添加月度、季度等自定义季节性
5. **外部协变量集成** - 将营销支出、竞争对手活动等外部因素纳入预测模型
6. **参数调优** - 自动搜索最佳参数组合以提高预测准确性

## 安装依赖

运行以下命令安装所需的 Python 库：

```bash
pip install prophet pandas numpy matplotlib scikit-learn
```

可选安装（用于交互式可视化）：
```bash
pip install plotly
```

## 使用方法

直接运行 Python 文件：

```bash
python prophet-demo.py
```

程序将执行以下步骤：
1. 生成模拟销售数据（包含趋势、季节性和随机波动）
2. 训练基础 Prophet 模型并进行预测
3. 依次演示各个高级功能示例
4. 显示各种可视化图表

## 数据说明

示例使用了模拟数据，生成了 2018-2023 年的每日销售数据，包含以下特征：
- 线性增长趋势
- 周季节性（周末销售额较高）
- 年度季节性（圣诞节期间销售额高峰）
- 随机促销活动的影响

## 自定义和扩展

您可以通过以下方式自定义和扩展代码：

1. **使用真实数据**：替换模拟数据部分，使用您自己的时间序列数据
2. **调整节假日**：修改节假日定义，添加与您业务相关的特殊日期
3. **调整季节性参数**：根据数据特性修改季节性模式和参数
4. **添加更多外部因素**：扩展外部协变量部分，纳入更多业务相关因素
5. **优化参数搜索范围**：根据您的数据特性调整参数调优的搜索范围

## 注意事项

- Prophet 默认使用加法模型，对于具有增长趋势且季节性幅度随趋势增长的数据，建议使用乘法模型
- 交叉验证可能需要较长时间运行，特别是对于大数据集
- 对于异常值较多的数据，可以通过降低 changepoint_prior_scale 参数提高模型的稳健性
- 如果预测结果不够理想，可以尝试调整季节性的 fourier_order 参数或添加更多自定义季节性

## 参考资料

- [Prophet 官方文档](https://facebook.github.io/prophet/)
- [Prophet GitHub 仓库](https://github.com/facebook/prophet)

## 常见问题

**Q: 遇到内存错误怎么办？**
A: 可以减小数据规模、降低交叉验证的初始训练期或预测范围

**Q: 如何处理缺失值？**
A: Prophet 会自动处理缺失值，但建议在训练前进行适当的数据清洗

**Q: 预测结果不理想怎么办？**
A: 尝试调整 changepoint_prior_scale、seasonality_prior_scale 等参数，或添加更多自定义季节性和外部协变量



